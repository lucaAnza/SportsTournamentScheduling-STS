\documentclass{article}

% Core math + hyperlinks (does not change fonts/margins)
\usepackage{amsmath, amssymb}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{booktabs}

% ---- Metadata (edit) ----
\title{CMDO 2025 - Sports Tournament Scheduling
(STS) problem}
\author{%
Luca Anzaldi \texttt{luca.anzaldi@studio.unibo.it} \and
Name Surname \texttt{name.surname@studio.unibo.it}
}
\date{\today}

% ---- Helpful macros (optional) ----
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\opt}{\mathrm{opt}}
\newcommand{\AllDiff}{\texttt{allDifferent}}

\begin{document}
\maketitle

% TODO : DELETE PROF INTRO
\section{Introduction}
This report addresses the solution of the well-known \emph{Sports Tournament Scheduling Problem (STS)}.
The focus is on presenting different modeling approaches and optimization techniques to handle the scheduling constraints and objectives.  
Throughout the report we describe the common elements that underlie all models: the inputs, symbols, shared objective variable and bounds, global pre-processing, and any assumptions. 
To avoid repetition, later sections will refer back to this introduction whenever these shared components are required.

\paragraph{Instance parameters}
Let \(T\) be the number of teams (even), \(W=T-1\) the number of weeks, and \(P=T/2\) the number of periods (parallel timeslots) per week.
Each solution is modeled referring to these three main variables.

\begin{itemize}
    \item Example1 : $ T = 6 \xrightarrow{} W = 4 $ and  $ P = 3 $
    \item Example2 : $ T = 16 \xrightarrow{} W = 15 $ and  $ P = 8 $
    \item Example3 : $ T = 5  \xrightarrow{} $ NOT VALID 
\end{itemize}

\paragraph{General constraints}
The classical formulation of the STS problem requires that:
\begin{enumerate}
    \item every team plays with every other team exactly once;
    \item every team plays exactly once per week;
    \item every team plays at most twice in the same period over the whole tournament.
\end{enumerate}

\paragraph{Objective function}

The main optimization criterion is to achieve a balanced schedule,
in which every team plays approximately the same number of home and away
games. In particular, given the instance parameters 
$T$ teams, $W$ weeks, and $P$ periods.
The objective is to minimize the overall imbalance:

\[
\min \; \sum_{t=1}^{T} \Big| \; 
\#\text{home\_games}(t) - \#\text{away\_games}(t) \; \Big|
\]

This formulation depends only on the instance parameters
($T, W, P$) that define how many games each team must play,
and expresses the high-level goal of fairness in the tournament.




% ---------------- CP ----------------
\section{CP Model}
This section is mandatory.

\subsection{Decision variables}
List all CP variables, with domains and semantics.
For example: $B_i \in \{0,\dots,100\}$ meaning $B_i = j$ iff baker $i$ cooks $j$ cakes.

\subsection{Objective function}
If the objective variable/bounds differ from Section~1, state it here.
Then give the CP objective. Example: minimize total area
$ \sum_{i=1}^{n} W_i \cdot H_i $.

\subsection{Constraints}
State and explain main problem constraints first; then (optionally) implied and symmetry-breaking constraints.

\paragraph{Main constraints.}
Formalize each constraint compactly and explain its role.

\paragraph{Implied constraints (optional).}
Explain why implied constraints hold and how they tighten propagation.

\paragraph{Symmetry breaking (optional).}
Identify model symmetries and show how your constraints reduce them.

\subsection{Validation}
Implement the model in \texttt{MiniZinc}; run at least \texttt{Gecode}
(and optionally other solvers). Design reproducible experiments.

\paragraph{Experimental design.}
Specify solvers, search strategies, hardware/software, time limits, and any per-instance settings.

\paragraph{Experimental results.}
Report objective values (best found or proven optimal).
Mark proven optima in \textbf{bold}. Use \texttt{UNSAT} if proven infeasible; use \texttt{N/A} or ``--'' on timeout.

\begin{table}[h]
\centering
\caption{Results with/without symmetry breaking (example layout).}
\label{tab:cp}
\begin{tabular}{lcccc}
\toprule
\textbf{ID} & \textbf{Chuffed+SB} & \textbf{Chuffed--SB} & \textbf{Gecode+SB} & \textbf{Gecode--SB}\\
\midrule
1 & \textbf{80} & 120 & 80 & 80 \\
2 & 50 & 60 & N/A & N/A \\
3 & UNSAT & UNSAT & N/A & N/A \\
\bottomrule
\end{tabular}
\end{table}

% ---------------- SAT ----------------
\section{SAT Model}

The SAT solution was made using two different modeling approaches. Both are included in the report. 

\paragraph{Notation.}
Throughout the constraints we use the following shorthand:

\[
\begin{aligned}
\sum x_i \;\;\geq 1 &\quad\Longleftrightarrow\quad \text{``at least $k$ of the $x_i$ is true''}, \\[6pt]
\sum x_i \;\;= 1   &\quad\Longleftrightarrow\quad \text{``exactly $k$ of the $x_i$ is true''}, \\[6pt]
\sum x_i \;\;\leq k &\quad\Longleftrightarrow\quad \text{``at most $k$ of the $x_i$ are true''}.
\end{aligned}
\]

In the implementation these correspond respectively to the encodings 
\texttt{at\_least\_k}, \texttt{exactly\_k}, and \texttt{at\_most\_k}. The special cases with $k=1$ are captured by the usual constraints:
$ \texttt{at\_least\_one}, 
\texttt{at\_most\_one}, $ and $ 
\texttt{exactly\_one}.
$


\subsection{Decision variables}

\subsubsection{Model - 1}

\paragraph{Booleans}

\begin{itemize}
    \item  $ X_{t,h,p,w}\in\{0,1\} \quad\text{meaning team }t\text{ is scheduled with role }h\text{ in slot }(p,w). $
\end{itemize}

\subsubsection{Model - 2}

\paragraph{Booleans}

\begin{itemize}
    \item  $ M_{t_1,t_2,w} \in \{0,1\} \quad\text{meaning teams $t_1$ and $t_2$ play against each other in week $w$}. $
    \item $HOME_{t,w} \in \{0,1\} \quad\text{meaning team $t$ plays at home in week $w$ (away otherwise)}.$
    \item $P_{t,p,w} \in \{0,1\} \quad\text{meaning team $t$ is assigned to period $p$ in week $w$}.$
\end{itemize}


\paragraph{Remarks.}

Model--2 introduces explicit pair variables \(M_{t_1,t_2,w}\) to capture
which two teams meet in a given week, home assignment variables
\(HOME_{t,w}\) to distinguish roles, and period variables
\(P_{t,p,w}\) to ensure consistency of scheduling. It also supports
a \emph{precomputing} mode, where a round-robin structure is generated
in advance and infeasible pairs are pruned by setting the corresponding
\(M_{t_1,t_2,w}\) literals to false.


\subsection{Objective function}

\subsubsection{Model - 1}

We minimize total home/away imbalance across teams:
\[
\min \;\; \sum_{t=1}^{T} \left| 
\sum_{p=1}^{P}\sum_{w=1}^{W} \big( X_{t,0,p,w} - X_{t,1,p,w} \big)
\right|.
\]
In the implementation with \texttt{Z3}, the optimization is performed by 
\emph{iterative (binary) search} on a pseudo-Boolean bound \(z\). 
At each step we introduce a constraint of the form 
\(\sum_t \lvert \cdot \rvert \leq z\), encoded using cardinality 
constraints, and solve for feasibility. If satisfiable, the bound 
is tightened; otherwise the process stops at the last feasible value.

\subsubsection{Model - 2 }

As in Model--1, the optimization criterion is to balance the number of
home and away games for each team. Formally:

\[
\min \sum_{t=1}^T \left| \sum_{w=1}^W HOME_{t,w}
      - \Big(W - \sum_{w=1}^W HOME_{t,w}\Big) \right|.
\]


\subsection{Constraints}

\subsubsection{Model - 1 }

\paragraph{Main constraints.}

\begin{itemize}
\item[(C1)] \textbf{Every pair of teams plays at most once.}  
For each distinct pair of teams $t_1,t_2 \in \{1,\dots,T\}$:
\[
\sum_{p=1}^{P}\sum_{w=1}^{W}
\Big( \bigvee_{h\in\{0,1\}} X_{t_1,h,p,w} \;\;\land\;\;
       \bigvee_{h\in\{0,1\}} X_{t_2,h,p,w} \Big)
\;\;\leq 1.
\]

\item[(C2)] \textbf{Each team plays exactly once per week.}  
For every team $t$ and week $w$:
\[
\sum_{h\in\{0,1\}}\sum_{p=1}^{P} X_{t,h,p,w} \;=\; 1.
\]

\item[(C3)] \textbf{Each team appears at most twice in the same period over the tournament.}  
For every team $t$ and period $p$:
\[
\sum_{h\in\{0,1\}}\sum_{w=1}^{W} X_{t,h,p,w} \;\leq\; 2.
\]
\end{itemize}

\paragraph{Implied constraints.}

\begin{itemize}
\item[(C4)] \textbf{Each game slot has exactly one home and one away team.}  
For every period $p$ and week $w$:
\[
\sum_{t=1}^{T} X_{t,1,p,w} = 1
\quad\text{and}\quad
\sum_{t=1}^{T} X_{t,0,p,w} = 1.
\]
\end{itemize}

\paragraph{Simmetry breaking.}

\begin{itemize}
\item[(C5)] {Fixing the first line of the schedule (symmetry-breaking).}  
To reduce symmetry, the matches for the first week / period are fixed:
\[
\bigwedge_{t=1}^{T-1} \big( X_{t,0,1,t} \;\lor\; X_{t,1,1,t} \big)
\quad\land\quad
\big( X_{T,0,1,1} \;\lor\; X_{T,1,1,1} \big).
\]
\end{itemize}

\subsubsection{Model - 2 }

\paragraph{Main constraints.}

\begin{itemize}
\item[(C1)] \textbf{Each team plays with every other team only once;}
\[
\forall\, t_1<t_2:\qquad
\sum_{w=1}^{W} M_{t_1,t_2,w} \;=\; 1.
\]

\item[(C2)] \textbf{Each team plays exactly once per week}
\[
\forall\, t,\,w:\qquad
\sum_{p=1}^{P} P_{t,p,w} \;=\; 1.
\]

\item[(C3)] \textbf{Each team plays at most twice in the same period}
\[
\forall\, t,\,p:\qquad
\sum_{w=1}^{W} P_{t,p,w} \;\le\; 2.
\]

\item[(C4)] \textbf{Each slot \((p,w)\) hosts exactly two teams.}
\[
\forall\, p,\,w:\qquad
\sum_{t=1}^{T} P_{t,p,w} \;=\; 2.
\]
\end{itemize}

\paragraph{Implied constraints.}

\begin{itemize}
\item[(C5)] \textbf{Home/away consistency when two teams meet in week \(w\).}
\[
\forall\, w,\, t_1<t_2:\qquad
M_{t_1,t_2,w} \;\Rightarrow\; \big(HOME_{t_1,w} \oplus HOME_{t_2,w}\big).
\]

\item[(C6)] \textbf{Link between pair variables and period assignments.}
\[
\forall\, w,\, t_1<t_2:\qquad
M_{t_1,t_2,w} \;\Rightarrow\; \bigvee_{p=1}^{P}\big(P_{t_1,p,w}\land P_{t_2,p,w}\big),
\]
\[
\forall\, w,\,p,\, t_1<t_2:\qquad
\big(P_{t_1,p,w}\land P_{t_2,p,w}\big) \;\Rightarrow\; M_{t_1,t_2,w}.
\]
(Equivalently: \(M_{t_1,t_2,w}\) iff the two teams share some period \(p\) in week \(w\).)
\end{itemize}

\paragraph{Simmetry breaking.}

\begin{itemize}
\item[(C7)] \textbf{Precomputed round-robin pruning.}
Let \(\mathcal{R}_w\subseteq\{\{t_1,t_2\}\mid t_1<t_2\}\) be the fixed set of pairs for week \(w\) produced by the round-robin generator. Then:
\[
\forall\, w,\, t_1<t_2:\qquad
M_{t_1,t_2,w} =
\begin{cases}
1, & \text{if }\{t_1,t_2\}\in \mathcal{R}_w,\\[4pt]
0, & \text{otherwise.}
\end{cases}
\]
\end{itemize}


% === Validation ===

\subsection{Validation}

\paragraph{Experimental Setup} \mbox{}\\
\\
All experiments were conducted using the \texttt{Z3} solver for SAT and
optimization. The implementation is provided in Python, and the solver is
invoked through the \textbf{Z3 API}. 
\\
The experiments were run on two different operating systems, namely
\emph{Windows} and \emph{Linux}, to ensure portability of the implementation.
The hardware platform was a laptop equipped with a \textit{12th Gen
Intel(R) Core(TM) i7-1280P} processor and an \textit{NVIDIA RTX-3060 GPU}. No GPU
acceleration was employed for the SAT solving itself, which ran entirely on
the CPU.  \\
\\
In order to reproduce the experiments, it is sufficient to follow the
instructions provided in the accompanying \texttt{README.md} file, which
details the installation steps and execution commands. The solver was run
without a fixed time limit, but execution times were recorded as reported in
the results section.
\\
For reproducibility, a fixed random seed (\texttt{SEED\_FOR\_REPRODUTION})
can be set in the configuration. By default this seed is set to~0, meaning
that Z3â€™s internal randomization is left free, but setting it to a positive
integer ensures deterministic and repeatable runs across different executions
and platforms.



\paragraph{Experimental results} \mbox{}\\

\begin{table}[h!]

\label{tab:results}
\begin{tabular}{c|c|c|c}
\hline
$N$ & Bitwise Encoding & Heule Encoding & Precomputing + Heule \\
\hline
6   & \textbf{0}  & \textbf{0}  & \textbf{0}  \\
8   & 2           & \textbf{0}  & \textbf{0}  \\
10  & 4           & 2           & \textbf{0}  \\
12  & --          & 6           & \textbf{2}  \\
14  & --          & --          & 4           \\
16  & UNSAT       & UNSAT       & UNSAT       \\
\hline
\end{tabular}
\end{table}






% ---------------- MIP ----------------
\section{MIP Model}
This section is mandatory.

\subsection{Decision variables}
List variables and domains (continuous/integer/binary).

\subsection{Objective function}
Linear objective consistent with Section~1 (state differences if any).

\subsection{Constraints}
All constraints must be linear; give compact matrix/inequality forms where possible.

\subsection{Validation}
Run on at least one MIP solver; solver-independent modeling (e.g., \texttt{AMPL}) is a plus.
Report as in CP.

% --------------- Conclusions ---------------
\section{Conclusions}
Summarize findings, modeling trade-offs, and comparative performance insights.

% --------------- Authorship ---------------
\section*{Authenticity and Author Contribution Statement}
We declare that the work reported here is our own and properly cites all external ideas and sources.
Parts of this project (text/code/experiments) were assisted by AI tools where indicated; we disclose the tools used and the exact sections where AI assistance was applied.
\\[0.5em]
\textbf{Author contributions.} Briefly outline the role of each author (modeling, implementation, experiments, analysis, writing).

% --------------- References ---------------
\begin{thebibliography}{9}

\bibitem{minizinc}
MiniZinc: The Modeling Language,
\url{https://www.minizinc.org/}.


\end{thebibliography}

\end{document}

